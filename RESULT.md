# PostgreSQLタイムゾーンテスト結果

## 環境設定

### postgres-utc (コンテナTZ: UTC)
*接続エラーのため、データを取得できませんでした*

### postgres-jst (コンテナTZ: Asia/Tokyo)

| パラメータ                          | 値                             |
|:-------------------------------|:------------------------------|
| current_setting('timezone')    | Asia/Tokyo                    |
| current_setting('TimeZone')    | Asia/Tokyo                    |
| SHOW timezone                  | Asia/Tokyo                    |
| now()                          | 2025-03-27 13:07:28.044758+09 |
| CURRENT_TIMESTAMP              | 2025-03-27 13:07:28.044758+09 |
| CURRENT_TIMESTAMP::timestamp   | 2025-03-27 13:07:28.044758    |
| CURRENT_TIMESTAMP::timestamptz | 2025-03-27 13:07:28.044758+09 |

### postgres-est (コンテナTZ: America/New_York)

| パラメータ                          | 値                             |
|:-------------------------------|:------------------------------|
| current_setting('timezone')    | America/New_York              |
| current_setting('TimeZone')    | America/New_York              |
| SHOW timezone                  | America/New_York              |
| now()                          | 2025-03-27 00:07:28.136054-04 |
| CURRENT_TIMESTAMP              | 2025-03-27 00:07:28.136054-04 |
| CURRENT_TIMESTAMP::timestamp   | 2025-03-27 00:07:28.136054    |
| CURRENT_TIMESTAMP::timestamptz | 2025-03-27 00:07:28.136054-04 |

## タイムスタンプテスト結果

### postgres-jst と postgres-est の結果

#### タイムゾーン設定別のテスト結果 - JST (Asia/Tokyo)

##### セッションタイムゾーン: America/New_York

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 07:00:00-05 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2022-12-31 22:00:00-05 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: Asia/Tokyo

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 21:00:00+09 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-02 02:00:00+09 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: UTC

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+00 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+00 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2023-01-01 03:00:00+00 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-01 17:00:00+00 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: デフォルト（コンテナTZ）

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 21:00:00+09 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-02 02:00:00+09 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

#### タイムゾーン設定別のテスト結果 - EST (America/New_York)

##### セッションタイムゾーン: America/New_York

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 07:00:00-05 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2022-12-31 22:00:00-05 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: Asia/Tokyo

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 21:00:00+09 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+09 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-02 02:00:00+09 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: UTC

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+00 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 12:00:00+00 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2023-01-01 03:00:00+00 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-01 17:00:00+00 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

##### セッションタイムゾーン: デフォルト（コンテナTZ）

| 入力値の説明     | 入力 timestamp               | 入力 timestamptz             | 出力 timestamp        | 出力 timestamptz         | timestamptz at UTC   | timestamptz at JST   | timestamptz at EST   |
|:-----------|:---------------------------|:---------------------------|:--------------------|:-----------------------|:---------------------|:---------------------|:---------------------|
| タイムゾーン情報なし | 2023-01-01 12:00:00        | 2023-01-01 12:00:00        | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |
| UTC指定      | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 UTC    | 2023-01-01 12:00:00 | 2023-01-01 07:00:00-05 | 2023-01-01 12:00:00  | 2023-01-01 21:00:00  | 2023-01-01 07:00:00  |
| JST指定      | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 +09:00 | 2023-01-01 12:00:00 | 2022-12-31 22:00:00-05 | 2023-01-01 03:00:00  | 2023-01-01 12:00:00  | 2022-12-31 22:00:00  |
| EST指定      | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 -05:00 | 2023-01-01 12:00:00 | 2023-01-01 12:00:00-05 | 2023-01-01 17:00:00  | 2023-01-02 02:00:00  | 2023-01-01 12:00:00  |

## 概要と結論

### timestamp型とtimestamptz型の違い

- **timestamp型**: タイムゾーン情報を保持しない。入力時にタイムゾーン情報があっても無視される。
- **timestamptz型**: タイムゾーン情報をUTCに変換して保存。出力時はセッションのタイムゾーンに変換される。

### コンテナタイムゾーンとセッションタイムゾーンの影響

- **コンテナタイムゾーン**: PostgreSQLのシステムタイムゾーンとなる。CURRENT_TIMESTAMPなどの関数に影響する。
- **セッションタイムゾーン**: timestamptz型の値をクライアントに返す際の表示タイムゾーン。

### 実用上の注意点

- タイムゾーンを正確に扱うためには、timestamptz型を使用することを推奨。
- アプリケーション間でタイムスタンプを受け渡す場合は、タイムゾーン情報を明示的に含める。
- セッションタイムゾーンはアプリケーションの要件に応じて適切に設定する。
